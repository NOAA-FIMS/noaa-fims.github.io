name: Notify FIMS on Bootstrap File Change in FIMS Website Repo

on:
  push:
    paths:
      - site_libs/bootstrap/**
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v5
        with:
          ref: gh-pages

      - name: Check for target .css file
        id: target_file
        run: |
          LIGHT=$(ls site_libs/bootstrap | grep -E '^bootstrap-[0-9a-f]+\.min\.css$' | grep -v 'dark' | head -n 1 || true)
          DARK=$(ls site_libs/bootstrap | grep -E '^bootstrap-dark-[0-9a-f]+\.min\.css$' | head -n 1 || true)

          echo "TARGET_LIGHT=$LIGHT" >> "$GITHUB_ENV"
          echo "TARGET_DARK=$DARK" >> "$GITHUB_ENV"

          if [ -z "$LIGHT" ] && [ -z "$DARK" ]; then
            echo "No matching light or dark bootstrap css file found"
            exit 0
          fi

          echo "Found light: ${LIGHT:-<none>}"
          echo "Found dark:  ${DARK:-<none>}"

      - name: Repository Dispatch
        if: env.TARGET != ''
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.REPO_A_PAT }} #need to change back
          repository: e-perl-NOAA/FIMS #need to change back
          event-type: file-updated
